// Jest Snapshot v1, https://jestjs.io/docs/snapshot-testing

exports[`review_auto tool selects review_diff when diff is provided 1`] = `
{
  "output": {
    "classification": "feature",
    "fail_reasons": [],
    "findings": [
      {
        "category": "reliability",
        "confidence": 0.95,
        "evidence": [
          "changed_files: src/a.ts",
        ],
        "id": "PRE001",
        "impact": "Risk of regressions is higher without test changes or additions.",
        "location": {
          "endLine": 1,
          "file": "src/a.ts",
          "startLine": 1,
        },
        "recommendation": "Add or update tests covering the modified behavior, or justify why no tests are needed.",
        "severity": "MEDIUM",
        "title": "No tests appear to be touched by this change",
      },
      {
        "category": "architecture",
        "confidence": 0.9,
        "evidence": [
          "Detected export-related changes or updates to entry/tool registration paths.",
        ],
        "id": "PRE002",
        "impact": "Downstream clients may break if the API change is not backward compatible.",
        "location": {
          "endLine": 1,
          "file": "src/a.ts",
          "startLine": 1,
        },
        "recommendation": "Review API compatibility, update documentation, and ensure semantic versioning expectations are met.",
        "severity": "HIGH",
        "title": "Possible public API surface change detected",
      },
    ],
    "hotspots": [],
    "metadata": {
      "reviewed_at": "<fixed>",
      "tool_version": "1.9.0",
      "warnings": [],
    },
    "risk_score": 4,
    "run_id": "<fixed>",
    "should_fail": false,
    "stats": {
      "deterministic_checks_executed": 5,
      "duration_ms": 0,
      "files_changed": 1,
      "invariants_executed": 0,
      "lines_added": 1,
      "lines_removed": 1,
      "llm_findings_added": 0,
      "llm_passes_executed": 0,
      "static_analyzers_executed": 0,
      "timings_ms": {},
    },
    "summary": "Classified as feature. Risk 4/5. 1 files changed (+1/-1). 2 deterministic findings.",
  },
  "rationale": "diff provided -> using review_diff",
  "selected_tool": "review_diff",
}
`;

exports[`review_auto tool selects review_git_diff when no diff is provided 1`] = `
{
  "output": {
    "git_info": {
      "command": "git diff --unified=3 --staged",
      "files_changed": [
        "src/a.ts",
      ],
      "stats": {
        "additions": 1,
        "deletions": 0,
        "files_count": 1,
      },
      "target": "staged",
    },
    "review": {
      "changes_summary": {
        "files_changed": 1,
        "lines_added": 1,
        "lines_removed": 0,
      },
      "findings": [
        {
          "body": "Mocked output.",
          "category": "correctness",
          "code_location": {
            "file_path": "src/a.ts",
            "line_range": {
              "end": 2,
              "start": 2,
            },
          },
          "confidence_score": 0.95,
          "id": "finding_1",
          "is_on_changed_line": true,
          "priority": 1,
          "suggestion": {
            "can_auto_fix": false,
            "description": "Add a guard",
          },
          "title": "Add input validation",
        },
      ],
      "metadata": {
        "categories_reviewed": [
          "correctness",
          "security",
          "performance",
          "maintainability",
          "style",
          "documentation",
        ],
        "confidence_threshold": 0.7,
        "findings_filtered": 1,
        "model_used": "auggie-context-engine",
        "review_duration_ms": 0,
        "reviewed_at": "<fixed>",
        "tool_version": "1.0.0",
      },
      "overall_confidence_score": 0.8,
      "overall_correctness": "needs attention",
      "overall_explanation": "Mocked output.",
    },
  },
  "rationale": "no diff provided -> using review_git_diff",
  "selected_tool": "review_git_diff",
}
`;
